<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>CABS Learner - Number System Converter & Drill</title>
    <style>
        /* ============================================
           CSS VARIABLES & THEME SYSTEM
           ============================================ */
        :root {
            /* Dark theme (default) */
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --bg-input: #1a1a2e;
            --text-primary: #eaeaea;
            --text-secondary: #a0a0a0;
            --text-muted: #6a6a6a;
            --accent: #e94560;
            --accent-hover: #ff6b6b;
            --success: #00d26a;
            --error: #ff4757;
            --warning: #ffa502;
            --border: #2a2a4a;
            --shadow: rgba(0, 0, 0, 0.3);
            --transition-speed: 0.3s;
        }

        [data-theme="light"] {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e8e8e8;
            --bg-input: #ffffff;
            --text-primary: #1a1a2e;
            --text-secondary: #4a4a4a;
            --text-muted: #8a8a8a;
            --accent: #e94560;
            --accent-hover: #d63050;
            --success: #00a854;
            --error: #d63031;
            --warning: #e67e22;
            --border: #d0d0d0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        /* ============================================
           BASE STYLES & RESET
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color var(--transition-speed), color var(--transition-speed);
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* ============================================
           LAYOUT CONTAINERS
           ============================================ */
        .app-container {
            min-height: 100%;
            display: flex;
            flex-direction: column;
            max-width: 480px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            margin-bottom: 1rem;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .header-buttons {
            display: flex;
            gap: 0.5rem;
        }

        /* ============================================
           BUTTONS
           ============================================ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.25rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all var(--transition-speed);
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            min-height: 48px;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
        }

        .btn-primary:active {
            background-color: var(--accent-hover);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-icon {
            padding: 0.5rem;
            width: 44px;
            height: 44px;
            border-radius: 10px;
        }

        .btn-large {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            border-radius: 16px;
        }

        /* ============================================
           MODE TABS
           ============================================ */
        .mode-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .mode-tab {
            flex: 1;
            padding: 1rem;
            font-size: 1rem;
            font-weight: 600;
            background-color: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all var(--transition-speed);
            color: var(--text-secondary);
        }

        .mode-tab.active {
            background-color: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* ============================================
           CARDS & SECTIONS
           ============================================ */
        .card {
            background-color: var(--bg-secondary);
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
        }

        /* ============================================
           INPUT STYLES
           ============================================ */
        .input-group {
            margin-bottom: 1rem;
        }

        .input-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .input-field {
            width: 100%;
            padding: 0.875rem 1rem;
            font-size: 1.125rem;
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
            background-color: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            transition: border-color var(--transition-speed);
            min-height: 52px;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent);
        }

        .input-field.has-error {
            border-color: var(--error);
        }

        /* Monospace display for conversions */
        .mono-display {
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
            font-size: 1.25rem;
            padding: 1rem;
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            word-break: break-all;
            letter-spacing: 1px;
        }

        /* Invalid character highlighting */
        .char-valid {
            color: var(--text-primary);
        }

        .char-invalid {
            color: var(--error);
            background-color: rgba(255, 71, 87, 0.2);
            border-radius: 2px;
            padding: 0 2px;
        }

        /* ============================================
           BASE SELECTOR
           ============================================ */
        .base-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .base-btn {
            flex: 1;
            min-width: 80px;
            padding: 0.75rem 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            background-color: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all var(--transition-speed);
            color: var(--text-secondary);
        }

        .base-btn.active {
            background-color: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .base-btn:active {
            transform: scale(0.96);
        }

        /* ============================================
           OUTPUT DISPLAY
           ============================================ */
        .output-section {
            margin-top: 1rem;
        }

        .output-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }

        .output-row:last-child {
            border-bottom: none;
        }

        .output-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .output-value {
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
            font-size: 1rem;
            color: var(--text-primary);
            text-align: right;
            word-break: break-all;
            max-width: 60%;
        }

        /* ============================================
           DRILL MODE STYLES
           ============================================ */
        .drill-setup {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .preset-btn {
            padding: 0.75rem;
            font-size: 0.875rem;
            background-color: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all var(--transition-speed);
            color: var(--text-primary);
        }

        .preset-btn.active {
            border-color: var(--accent);
            background-color: rgba(233, 69, 96, 0.1);
        }

        .range-inputs {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .range-inputs .input-field {
            flex: 1;
        }

        .range-separator {
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Question display */
        .question-container {
            text-align: center;
            padding: 1.5rem 0;
        }

        .question-progress {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .question-timer {
            font-size: 1rem;
            color: var(--warning);
            margin-bottom: 1rem;
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
        }

        .question-prompt {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .question-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
            color: var(--accent);
            margin-bottom: 1rem;
            word-break: break-all;
        }

        .question-target {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Answer feedback */
        .feedback {
            text-align: center;
            padding: 1rem;
            border-radius: 12px;
            margin-top: 1rem;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .feedback.correct {
            background-color: rgba(0, 210, 106, 0.15);
            color: var(--success);
        }

        .feedback.incorrect {
            background-color: rgba(255, 71, 87, 0.15);
            color: var(--error);
        }

        .correct-answer {
            margin-top: 0.5rem;
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .correct-answer span {
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
            color: var(--text-primary);
        }

        /* Steps display */
        .steps-toggle {
            margin-top: 1rem;
            text-align: center;
        }

        .steps-content {
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--bg-tertiary);
            border-radius: 12px;
            text-align: left;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .step-line {
            padding: 0.25rem 0;
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
            color: var(--text-secondary);
        }

        .step-highlight {
            color: var(--accent);
            font-weight: 600;
        }

        /* Summary screen */
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-box {
            text-align: center;
            padding: 1rem 0.5rem;
            background-color: var(--bg-tertiary);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .question-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .question-item {
            padding: 0.75rem;
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .question-item.correct {
            border-left: 3px solid var(--success);
        }

        .question-item.incorrect {
            border-left: 3px solid var(--error);
        }

        .question-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }

        .question-item-q {
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
        }

        .question-item-answers {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* ============================================
           MODAL / OVERLAY
           ============================================ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-speed);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--bg-secondary);
            border-radius: 20px;
            padding: 1.5rem;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform var(--transition-speed);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
        }

        .tutorial-section {
            margin-bottom: 1.5rem;
        }

        .tutorial-section h3 {
            font-size: 1rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .tutorial-section p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* ============================================
           THEME TOGGLE
           ============================================ */
        .theme-toggle {
            position: relative;
            width: 44px;
            height: 44px;
            border-radius: 10px;
            background-color: var(--bg-tertiary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all var(--transition-speed);
        }

        /* ============================================
           HIDDEN VIEWS
           ============================================ */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* ============================================
           CHECKBOX TOGGLE
           ============================================ */
        .toggle-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }

        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
            background-color: var(--border);
            border-radius: 14px;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }

        .toggle-switch.active {
            background-color: var(--accent);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background-color: white;
            border-radius: 12px;
            transition: transform var(--transition-speed);
        }

        .toggle-switch.active::after {
            transform: translateX(24px);
        }

        /* ============================================
           SELECT DROPDOWN
           ============================================ */
        .select-field {
            width: 100%;
            padding: 0.875rem 1rem;
            font-size: 1rem;
            background-color: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23a0a0a0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            min-height: 52px;
        }

        /* ============================================
           UTILITY CLASSES
           ============================================ */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }

        /* ============================================
           SCROLLBAR STYLING
           ============================================ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ============================================
             HEADER
             ============================================ -->
        <header class="header">
            <h1>CABS Learner</h1>
            <div class="header-buttons">
                <button class="btn btn-icon" id="tutorialBtn" aria-label="Tutorial">?</button>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">ðŸŒ™</button>
            </div>
        </header>

        <!-- ============================================
             MODE TABS
             ============================================ -->
        <div class="mode-tabs">
            <button class="mode-tab active" data-mode="converter">Converter</button>
            <button class="mode-tab" data-mode="drill">Drill</button>
        </div>

        <!-- ============================================
             CONVERTER VIEW
             ============================================ -->
        <div class="view active" id="converterView">
            <div class="card">
                <div class="card-title">Input Base</div>
                <div class="base-selector" id="inputBaseSelector">
                    <button class="base-btn active" data-base="10">Decimal</button>
                    <button class="base-btn" data-base="2">Binary</button>
                    <button class="base-btn" data-base="16">Hexadecimal</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Enter Value</div>
                <input type="text" 
                       class="input-field" 
                       id="converterInput" 
                       placeholder="Enter number..."
                       autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       spellcheck="false">
                <div id="inputValidation" class="mono-display mt-2" style="display: none;"></div>
            </div>

            <div class="card">
                <div class="card-title">Output Bases</div>
                <div class="base-selector" id="outputBaseSelector">
                    <button class="base-btn active" data-base="10">Decimal</button>
                    <button class="base-btn active" data-base="2">Binary</button>
                    <button class="base-btn active" data-base="16">Hexadecimal</button>
                </div>
            </div>

            <div class="card" id="outputCard">
                <div class="card-title">Results</div>
                <div class="output-section" id="converterOutput">
                    <p class="text-center" style="color: var(--text-muted);">Enter a value above</p>
                </div>
            </div>
        </div>

        <!-- ============================================
             DRILL VIEW - SETUP
             ============================================ -->
        <div class="view" id="drillSetupView">
            <div class="card">
                <div class="card-title">Conversion Type</div>
                <select class="select-field" id="conversionType">
                    <option value="random">Random (All Types)</option>
                    <option value="dec2bin">Decimal â†’ Binary</option>
                    <option value="bin2dec">Binary â†’ Decimal</option>
                    <option value="dec2hex">Decimal â†’ Hexadecimal</option>
                    <option value="hex2dec">Hexadecimal â†’ Decimal</option>
                    <option value="bin2hex">Binary â†’ Hexadecimal</option>
                    <option value="hex2bin">Hexadecimal â†’ Binary</option>
                </select>
            </div>

            <div class="card">
                <div class="card-title">Difficulty Preset</div>
                <div class="preset-grid" id="difficultyPresets">
                    <button class="preset-btn active" data-min="0" data-max="15">Easy (0-15)</button>
                    <button class="preset-btn" data-min="0" data-max="255">Medium (0-255)</button>
                    <button class="preset-btn" data-min="0" data-max="4095">Hard (0-4095)</button>
                    <button class="preset-btn" data-min="0" data-max="65535">Expert (0-65535)</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Custom Range (Decimal)</div>
                <div class="range-inputs">
                    <input type="number" class="input-field" id="rangeMin" value="0" min="0" inputmode="numeric">
                    <span class="range-separator">to</span>
                    <input type="number" class="input-field" id="rangeMax" value="15" min="0" inputmode="numeric">
                </div>
            </div>

            <div class="card">
                <div class="card-title">Questions</div>
                <input type="number" class="input-field" id="questionCount" value="10" min="1" max="100" inputmode="numeric">
            </div>

            <div class="card">
                <div class="card-title">Time Limit</div>
                <div class="toggle-row">
                    <span>Enable time limit</span>
                    <div class="toggle-switch" id="timeLimitToggle"></div>
                </div>
                <div id="timeLimitOptions" class="hidden mt-2">
                    <input type="number" class="input-field" id="timeLimit" value="30" min="5" max="300" inputmode="numeric">
                    <span class="input-label mt-1">Seconds per question</span>
                </div>
            </div>

            <button class="btn btn-primary btn-large mt-2" id="startDrillBtn">Start Drill</button>
        </div>

        <!-- ============================================
             DRILL VIEW - QUESTION
             ============================================ -->
        <div class="view" id="drillQuestionView">
            <div class="card">
                <div class="question-container">
                    <div class="question-progress" id="questionProgress">Question 1 of 10</div>
                    <div class="question-timer hidden" id="questionTimer">30s</div>
                    <div class="question-prompt" id="questionPrompt">Convert from Decimal to Binary:</div>
                    <div class="question-value" id="questionValue">42</div>
                    <div class="question-target" id="questionTarget">Enter the Binary value</div>
                </div>
            </div>

            <div class="card">
                <input type="text" 
                       class="input-field" 
                       id="drillAnswer" 
                       placeholder="Your answer..."
                       autocomplete="off"
                       autocorrect="off"
                       autocapitalize="characters"
                       spellcheck="false">
                <button class="btn btn-primary btn-large mt-2" id="submitAnswerBtn">Submit</button>
            </div>

            <div id="feedbackSection" class="hidden">
                <div class="feedback" id="feedbackMessage"></div>
                <div class="correct-answer hidden" id="correctAnswerDisplay"></div>
                
                <div class="steps-toggle">
                    <button class="btn" id="showStepsBtn">Show Steps</button>
                </div>
                <div class="steps-content hidden" id="stepsContent"></div>
                
                <button class="btn btn-success btn-large mt-2" id="continueBtn">Continue (Enter)</button>
            </div>
        </div>

        <!-- ============================================
             DRILL VIEW - SUMMARY
             ============================================ -->
        <div class="view" id="drillSummaryView">
            <div class="card">
                <div class="card-title">Results</div>
                <div class="summary-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="summaryAccuracy">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="summaryTotal">0s</div>
                        <div class="stat-label">Total Time</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="summaryAvg">0s</div>
                        <div class="stat-label">Avg Time</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Questions</div>
                <div class="question-list" id="questionList"></div>
            </div>

            <button class="btn btn-primary btn-large mt-2" id="newDrillBtn">New Drill</button>
        </div>
    </div>

    <!-- ============================================
         TUTORIAL MODAL
         ============================================ -->
    <div class="modal-overlay" id="tutorialModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Tutorial</h2>
                <button class="modal-close" id="closeTutorial">&times;</button>
            </div>

            <div class="tutorial-section">
                <h3>What is CABS Learner?</h3>
                <p>CABS stands for "Convert All Base Systems". This app helps you practice converting numbers between Decimal (base 10), Binary (base 2), and Hexadecimal (base 16).</p>
            </div>

            <div class="tutorial-section">
                <h3>Converter Mode</h3>
                <p>Select your input base, enter a number, and see instant conversions to all selected output bases. Invalid characters are highlighted in red but don't block typing.</p>
            </div>

            <div class="tutorial-section">
                <h3>Drill Mode</h3>
                <p>Practice conversions with timed questions. Choose your difficulty, number of questions, and optional time limits. After each answer, view step-by-step conversion explanations.</p>
            </div>

            <div class="tutorial-section">
                <h3>Number Systems</h3>
                <p><strong>Decimal (Base 10):</strong> Uses digits 0-9. This is our everyday number system.</p>
                <p><strong>Binary (Base 2):</strong> Uses only 0 and 1. Each position represents a power of 2.</p>
                <p><strong>Hexadecimal (Base 16):</strong> Uses 0-9 and A-F. Each hex digit equals 4 binary bits.</p>
            </div>

            <div class="tutorial-section">
                <h3>Conversion Methods</h3>
                <p><strong>Dec â†’ Bin:</strong> Repeatedly divide by 2, collect remainders.</p>
                <p><strong>Bin â†’ Dec:</strong> Sum powers of 2 for each '1' bit.</p>
                <p><strong>Dec â†’ Hex:</strong> Divide by 16 (or 2 four times), collect remainders.</p>
                <p><strong>Hex â†’ Dec:</strong> Multiply each digit by its power of 16.</p>
                <p><strong>Bin â†” Hex:</strong> Group binary into 4-bit chunks, convert each to hex.</p>
            </div>

            <div class="tutorial-section">
                <h3>Tips</h3>
                <p>â€¢ Hex uses uppercase A-F (no 0x prefix)<br>
                â€¢ Press Enter to submit answers or continue<br>
                â€¢ Your progress is saved automatically<br>
                â€¢ Toggle dark/light mode with the moon/sun button</p>
            </div>
        </div>
    </div>

    <script>
        /* ============================================
           CABS LEARNER - MAIN APPLICATION
           ============================================ */

        (function() {
            'use strict';

            // ============================================
            // STATE MANAGEMENT
            // ============================================
            
            const state = {
                // Current mode: 'converter' or 'drill'
                mode: 'converter',
                
                // Converter state
                inputBase: 10,
                outputBases: [10, 2, 16],
                
                // Drill state
                drill: {
                    active: false,
                    conversionType: 'random',
                    rangeMin: 0,
                    rangeMax: 15,
                    questionCount: 10,
                    timeLimit: null,
                    currentQuestion: 0,
                    questions: [],
                    startTime: null,
                    questionStartTime: null,
                    timerInterval: null
                },
                
                // Theme
                darkMode: true,
                
                // Stats (persisted)
                stats: {
                    totalDrills: 0,
                    totalQuestions: 0,
                    correctAnswers: 0
                }
            };

            // ============================================
            // DOM ELEMENTS
            // ============================================
            
            const elements = {
                // Mode tabs
                modeTabs: document.querySelectorAll('.mode-tab'),
                
                // Views
                converterView: document.getElementById('converterView'),
                drillSetupView: document.getElementById('drillSetupView'),
                drillQuestionView: document.getElementById('drillQuestionView'),
                drillSummaryView: document.getElementById('drillSummaryView'),
                
                // Converter
                inputBaseSelector: document.getElementById('inputBaseSelector'),
                outputBaseSelector: document.getElementById('outputBaseSelector'),
                converterInput: document.getElementById('converterInput'),
                inputValidation: document.getElementById('inputValidation'),
                converterOutput: document.getElementById('converterOutput'),
                
                // Drill setup
                conversionType: document.getElementById('conversionType'),
                difficultyPresets: document.getElementById('difficultyPresets'),
                rangeMin: document.getElementById('rangeMin'),
                rangeMax: document.getElementById('rangeMax'),
                questionCount: document.getElementById('questionCount'),
                timeLimitToggle: document.getElementById('timeLimitToggle'),
                timeLimitOptions: document.getElementById('timeLimitOptions'),
                timeLimit: document.getElementById('timeLimit'),
                startDrillBtn: document.getElementById('startDrillBtn'),
                
                // Drill question
                questionProgress: document.getElementById('questionProgress'),
                questionTimer: document.getElementById('questionTimer'),
                questionPrompt: document.getElementById('questionPrompt'),
                questionValue: document.getElementById('questionValue'),
                questionTarget: document.getElementById('questionTarget'),
                drillAnswer: document.getElementById('drillAnswer'),
                submitAnswerBtn: document.getElementById('submitAnswerBtn'),
                feedbackSection: document.getElementById('feedbackSection'),
                feedbackMessage: document.getElementById('feedbackMessage'),
                correctAnswerDisplay: document.getElementById('correctAnswerDisplay'),
                showStepsBtn: document.getElementById('showStepsBtn'),
                stepsContent: document.getElementById('stepsContent'),
                continueBtn: document.getElementById('continueBtn'),
                
                // Drill summary
                summaryAccuracy: document.getElementById('summaryAccuracy'),
                summaryTotal: document.getElementById('summaryTotal'),
                summaryAvg: document.getElementById('summaryAvg'),
                questionList: document.getElementById('questionList'),
                newDrillBtn: document.getElementById('newDrillBtn'),
                
                // Theme & tutorial
                themeToggle: document.getElementById('themeToggle'),
                tutorialBtn: document.getElementById('tutorialBtn'),
                tutorialModal: document.getElementById('tutorialModal'),
                closeTutorial: document.getElementById('closeTutorial')
            };

            // ============================================
            // CONVERSION UTILITIES
            // ============================================
            
            /**
             * Validates if a string contains only valid characters for a given base
             * Returns an array of {char, valid} objects for highlighting
             */
            function validateInput(value, base) {
                const validChars = {
                    2: '01',
                    10: '0123456789',
                    16: '0123456789ABCDEFabcdef'
                };
                
                const allowed = validChars[base];
                const result = [];
                let hasInvalid = false;
                
                for (const char of value) {
                    const valid = allowed.includes(char);
                    if (!valid) hasInvalid = true;
                    result.push({ char, valid });
                }
                
                return { chars: result, hasInvalid };
            }

            /**
             * Extracts only valid characters from input
             */
            function getValidValue(value, base) {
                const validChars = {
                    2: '01',
                    10: '0123456789',
                    16: '0123456789ABCDEFabcdef'
                };
                
                const allowed = validChars[base];
                return value.split('').filter(c => allowed.includes(c)).join('');
            }

            /**
             * Converts a number from one base to another
             * Returns the converted value as a string (uppercase for hex)
             */
            function convert(value, fromBase, toBase) {
                if (!value || value === '') return '';
                
                // Clean input (uppercase for hex)
                const cleanValue = getValidValue(value.toUpperCase(), fromBase);
                if (!cleanValue) return '';
                
                // Convert to decimal first
                let decimal;
                if (fromBase === 10) {
                    decimal = parseInt(cleanValue, 10);
                } else if (fromBase === 2) {
                    decimal = parseInt(cleanValue, 2);
                } else if (fromBase === 16) {
                    decimal = parseInt(cleanValue, 16);
                }
                
                if (isNaN(decimal)) return '';
                
                // Convert from decimal to target base
                if (toBase === 10) {
                    return decimal.toString(10);
                } else if (toBase === 2) {
                    return decimal.toString(2);
                } else if (toBase === 16) {
                    return decimal.toString(16).toUpperCase();
                }
                
                return '';
            }

            /**
             * Generates step-by-step conversion explanation
             * Different methods based on conversion type
             */
            function generateSteps(value, fromBase, toBase, correctAnswer) {
                const cleanValue = getValidValue(value.toUpperCase(), fromBase);
                if (!cleanValue) return [];
                
                const steps = [];
                
                // Decimal to Binary: powers of two method
                if (fromBase === 10 && toBase === 2) {
                    const decimal = parseInt(cleanValue, 10);
                    steps.push(`Starting with decimal: ${decimal}`);
                    steps.push(`Method: Repeatedly divide by 2, collect remainders`);
                    steps.push('');
                    
                    let num = decimal;
                    const remainders = [];
                    let stepNum = 1;
                    
                    if (num === 0) {
                        steps.push('0 Ã· 2 = 0 remainder 0');
                        remainders.push(0);
                    } else {
                        while (num > 0) {
                            const remainder = num % 2;
                            const quotient = Math.floor(num / 2);
                            steps.push(`${stepNum}. ${num} Ã· 2 = ${quotient} remainder ${remainder}`);
                            remainders.push(remainder);
                            num = quotient;
                            stepNum++;
                        }
                    }
                    
                    steps.push('');
                    steps.push(`Reading remainders bottom-to-top: ${remainders.reverse().join('')}`);
                    steps.push(`Result: ${correctAnswer}`);
                }
                
                // Binary to Decimal: powers of two method
                else if (fromBase === 2 && toBase === 10) {
                    steps.push(`Starting with binary: ${cleanValue}`);
                    steps.push(`Method: Sum powers of 2 for each '1' bit`);
                    steps.push('');
                    
                    const bits = cleanValue.split('').reverse();
                    const terms = [];
                    let sum = 0;
                    
                    bits.forEach((bit, i) => {
                        if (bit === '1') {
                            const power = Math.pow(2, i);
                            terms.push(`2^${i} = ${power}`);
                            sum += power;
                        }
                    });
                    
                    if (terms.length === 0) {
                        steps.push('No 1 bits, result is 0');
                    } else {
                        terms.reverse().forEach(t => steps.push(t));
                        steps.push('');
                        steps.push(`Sum: ${terms.map(t => t.split(' = ')[1]).join(' + ')} = ${sum}`);
                    }
                    
                    steps.push(`Result: ${correctAnswer}`);
                }
                
                // Decimal to Hexadecimal: divide by 16 (as divide by 2 four times)
                else if (fromBase === 10 && toBase === 16) {
                    const decimal = parseInt(cleanValue, 10);
                    steps.push(`Starting with decimal: ${decimal}`);
                    steps.push(`Method: Divide by 16 (shown as 4 binary divisions)`);
                    steps.push('');
                    
                    let num = decimal;
                    const hexDigits = [];
                    
                    if (num === 0) {
                        hexDigits.push('0');
                        steps.push('0 gives hex digit 0');
                    } else {
                        let digitCount = 1;
                        while (num > 0) {
                            // Show the 4 binary divisions
                            let tempNum = num;
                            let fourBitRemainder = 0;
                            
                            steps.push(`Hex digit ${digitCount}:`);
                            
                            for (let i = 0; i < 4 && tempNum > 0; i++) {
                                const remainder = tempNum % 2;
                                fourBitRemainder += remainder * Math.pow(2, i);
                                tempNum = Math.floor(tempNum / 2);
                            }
                            
                            // Actually get the hex digit
                            const hexRemainder = num % 16;
                            const quotient = Math.floor(num / 16);
                            const hexChar = '0123456789ABCDEF'[hexRemainder];
                            
                            steps.push(`  ${num} mod 16 = ${hexRemainder} (${hexChar})`);
                            steps.push(`  ${num} Ã· 16 = ${quotient}`);
                            
                            hexDigits.push(hexChar);
                            num = quotient;
                            digitCount++;
                        }
                    }
                    
                    steps.push('');
                    steps.push(`Reading digits bottom-to-top: ${hexDigits.reverse().join('')}`);
                    steps.push(`Result: ${correctAnswer}`);
                }
                
                // Hexadecimal to Decimal: weighted sums
                else if (fromBase === 16 && toBase === 10) {
                    steps.push(`Starting with hexadecimal: ${cleanValue}`);
                    steps.push(`Method: Multiply each digit by its power of 16`);
                    steps.push('');
                    
                    const hexMap = { '0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7,
                                     '8': 8, '9': 9, 'A': 10, 'B': 11, 'C': 12, 'D': 13, 'E': 14, 'F': 15 };
                    
                    const digits = cleanValue.split('').reverse();
                    const terms = [];
                    let sum = 0;
                    
                    digits.forEach((digit, i) => {
                        const val = hexMap[digit];
                        const power = Math.pow(16, i);
                        const product = val * power;
                        terms.push(`${digit} Ã— 16^${i} = ${val} Ã— ${power} = ${product}`);
                        sum += product;
                    });
                    
                    terms.reverse().forEach(t => steps.push(t));
                    steps.push('');
                    steps.push(`Sum: ${sum}`);
                    steps.push(`Result: ${correctAnswer}`);
                }
                
                // Binary to Hexadecimal: 4-bit grouping
                else if (fromBase === 2 && toBase === 16) {
                    steps.push(`Starting with binary: ${cleanValue}`);
                    steps.push(`Method: Group into 4-bit chunks, convert each to hex`);
                    steps.push('');
                    
                    // Pad to multiple of 4
                    let padded = cleanValue;
                    while (padded.length % 4 !== 0) {
                        padded = '0' + padded;
                    }
                    
                    steps.push(`Padded: ${padded}`);
                    steps.push('');
                    
                    const hexDigits = [];
                    for (let i = 0; i < padded.length; i += 4) {
                        const group = padded.substr(i, 4);
                        const decimal = parseInt(group, 2);
                        const hex = '0123456789ABCDEF'[decimal];
                        steps.push(`${group} = ${decimal} = ${hex}`);
                        hexDigits.push(hex);
                    }
                    
                    steps.push('');
                    steps.push(`Result: ${hexDigits.join('')}`);
                }
                
                // Hexadecimal to Binary: 4-bit expansion
                else if (fromBase === 16 && toBase === 2) {
                    steps.push(`Starting with hexadecimal: ${cleanValue}`);
                    steps.push(`Method: Convert each hex digit to 4-bit binary`);
                    steps.push('');
                    
                    const hexMap = { '0': '0000', '1': '0001', '2': '0010', '3': '0011',
                                     '4': '0100', '5': '0101', '6': '0110', '7': '0111',
                                     '8': '1000', '9': '1001', 'A': '1010', 'B': '1011',
                                     'C': '1100', 'D': '1101', 'E': '1110', 'F': '1111' };
                    
                    const binaryParts = [];
                    for (const digit of cleanValue) {
                        const binary = hexMap[digit];
                        steps.push(`${digit} = ${binary}`);
                        binaryParts.push(binary);
                    }
                    
                    // Remove leading zeros
                    let result = binaryParts.join('');
                    result = result.replace(/^0+/, '') || '0';
                    
                    steps.push('');
                    steps.push(`Combined: ${binaryParts.join('')}`);
                    steps.push(`Result: ${result}`);
                }
                
                return steps;
            }

            // ============================================
            // CONVERTER MODE
            // ============================================
            
            /**
             * Updates the converter output based on current input
             */
            function updateConverter() {
                const value = elements.converterInput.value;
                const validation = validateInput(value, state.inputBase);
                
                // Show validation highlighting
                if (value && validation.hasInvalid) {
                    elements.inputValidation.style.display = 'block';
                    elements.inputValidation.innerHTML = validation.chars.map(c => 
                        `<span class="${c.valid ? 'char-valid' : 'char-invalid'}">${c.char}</span>`
                    ).join('');
                    elements.converterInput.classList.add('has-error');
                } else {
                    elements.inputValidation.style.display = 'none';
                    elements.converterInput.classList.remove('has-error');
                }
                
                // Generate outputs
                const cleanValue = getValidValue(value.toUpperCase(), state.inputBase);
                
                if (!cleanValue) {
                    elements.converterOutput.innerHTML = '<p class="text-center" style="color: var(--text-muted);">Enter a value above</p>';
                    return;
                }
                
                const baseNames = { 2: 'Binary', 10: 'Decimal', 16: 'Hexadecimal' };
                let outputHTML = '';
                
                state.outputBases.forEach(base => {
                    if (base !== state.inputBase) {
                        const converted = convert(cleanValue, state.inputBase, base);
                        outputHTML += `
                            <div class="output-row">
                                <span class="output-label">${baseNames[base]}</span>
                                <span class="output-value">${converted}</span>
                            </div>
                        `;
                    }
                });
                
                // Also show input in its own base
                outputHTML = `
                    <div class="output-row">
                        <span class="output-label">${baseNames[state.inputBase]} (input)</span>
                        <span class="output-value">${cleanValue.toUpperCase()}</span>
                    </div>
                ` + outputHTML;
                
                elements.converterOutput.innerHTML = outputHTML;
            }

            /**
             * Sets the input type for the converter input
             */
            function updateInputType() {
                if (state.inputBase === 10) {
                    elements.converterInput.setAttribute('inputmode', 'numeric');
                } else {
                    elements.converterInput.setAttribute('inputmode', 'text');
                }
            }

            // ============================================
            // DRILL MODE
            // ============================================
            
            /**
             * Generates a random number within the configured range
             */
            function generateRandomNumber(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            /**
             * Gets a random conversion type
             */
            function getRandomConversionType() {
                const types = ['dec2bin', 'bin2dec', 'dec2hex', 'hex2dec', 'bin2hex', 'hex2bin'];
                return types[Math.floor(Math.random() * types.length)];
            }

            /**
             * Parses conversion type to get from/to bases
             */
            function parseConversionType(type) {
                const mapping = {
                    'dec2bin': { from: 10, to: 2 },
                    'bin2dec': { from: 2, to: 10 },
                    'dec2hex': { from: 10, to: 16 },
                    'hex2dec': { from: 16, to: 10 },
                    'bin2hex': { from: 2, to: 16 },
                    'hex2bin': { from: 16, to: 2 }
                };
                return mapping[type];
            }

            /**
             * Gets the display name for a base
             */
            function getBaseName(base) {
                return { 2: 'Binary', 10: 'Decimal', 16: 'Hexadecimal' }[base];
            }

            /**
             * Generates all questions for the drill
             */
            function generateQuestions() {
                const questions = [];
                const { rangeMin, rangeMax, questionCount, conversionType } = state.drill;
                
                for (let i = 0; i < questionCount; i++) {
                    // Get conversion type (random or fixed)
                    const type = conversionType === 'random' ? getRandomConversionType() : conversionType;
                    const { from, to } = parseConversionType(type);
                    
                    // Generate decimal value, then convert to question format
                    const decimalValue = generateRandomNumber(rangeMin, rangeMax);
                    const questionValue = convert(decimalValue.toString(), 10, from);
                    const correctAnswer = convert(questionValue, from, to);
                    
                    questions.push({
                        type,
                        fromBase: from,
                        toBase: to,
                        value: questionValue,
                        correctAnswer,
                        userAnswer: null,
                        correct: null,
                        time: null
                    });
                }
                
                return questions;
            }

            /**
             * Starts the drill
             */
            function startDrill() {
                // Read settings
                state.drill.conversionType = elements.conversionType.value;
                state.drill.rangeMin = Math.max(0, parseInt(elements.rangeMin.value) || 0);
                state.drill.rangeMax = Math.max(state.drill.rangeMin, parseInt(elements.rangeMax.value) || 15);
                state.drill.questionCount = Math.min(100, Math.max(1, parseInt(elements.questionCount.value) || 10));
                state.drill.timeLimit = elements.timeLimitToggle.classList.contains('active') 
                    ? parseInt(elements.timeLimit.value) || 30 
                    : null;
                
                // Generate questions
                state.drill.questions = generateQuestions();
                state.drill.currentQuestion = 0;
                state.drill.active = true;
                state.drill.startTime = Date.now();
                
                // Show question view
                showView('drillQuestion');
                showCurrentQuestion();
            }

            /**
             * Displays the current question
             */
            function showCurrentQuestion() {
                const q = state.drill.questions[state.drill.currentQuestion];
                
                elements.questionProgress.textContent = 
                    `Question ${state.drill.currentQuestion + 1} of ${state.drill.questionCount}`;
                elements.questionPrompt.textContent = 
                    `Convert from ${getBaseName(q.fromBase)} to ${getBaseName(q.toBase)}:`;
                elements.questionValue.textContent = q.value;
                elements.questionTarget.textContent = `Enter the ${getBaseName(q.toBase)} value`;
                
                // Reset UI
                elements.drillAnswer.value = '';
                elements.drillAnswer.disabled = false;
                elements.submitAnswerBtn.classList.remove('hidden');
                elements.feedbackSection.classList.add('hidden');
                elements.stepsContent.classList.add('hidden');
                elements.showStepsBtn.textContent = 'Show Steps';
                
                // Set input type
                if (q.toBase === 10) {
                    elements.drillAnswer.setAttribute('inputmode', 'numeric');
                } else {
                    elements.drillAnswer.setAttribute('inputmode', 'text');
                }
                
                elements.drillAnswer.focus();
                
                // Start timer
                state.drill.questionStartTime = Date.now();
                
                if (state.drill.timeLimit) {
                    elements.questionTimer.classList.remove('hidden');
                    updateTimer();
                    state.drill.timerInterval = setInterval(updateTimer, 100);
                } else {
                    elements.questionTimer.classList.add('hidden');
                }
            }

            /**
             * Updates the question timer
             */
            function updateTimer() {
                const elapsed = (Date.now() - state.drill.questionStartTime) / 1000;
                const remaining = Math.max(0, state.drill.timeLimit - elapsed);
                elements.questionTimer.textContent = `${remaining.toFixed(1)}s`;
                
                if (remaining <= 0) {
                    clearInterval(state.drill.timerInterval);
                    submitAnswer(true);
                }
            }

            /**
             * Submits the current answer
             */
            function submitAnswer(timedOut = false) {
                if (state.drill.timerInterval) {
                    clearInterval(state.drill.timerInterval);
                    state.drill.timerInterval = null;
                }
                
                const q = state.drill.questions[state.drill.currentQuestion];
                const userAnswer = elements.drillAnswer.value.toUpperCase().trim();
                const time = (Date.now() - state.drill.questionStartTime) / 1000;
                
                // Record answer
                q.userAnswer = userAnswer || (timedOut ? '(timed out)' : '(no answer)');
                q.time = time;
                q.correct = userAnswer === q.correctAnswer;
                
                // Show feedback
                elements.drillAnswer.disabled = true;
                elements.submitAnswerBtn.classList.add('hidden');
                elements.feedbackSection.classList.remove('hidden');
                
                if (q.correct) {
                    elements.feedbackMessage.textContent = 'Correct!';
                    elements.feedbackMessage.className = 'feedback correct';
                    elements.correctAnswerDisplay.classList.add('hidden');
                } else {
                    elements.feedbackMessage.textContent = 'Incorrect';
                    elements.feedbackMessage.className = 'feedback incorrect';
                    elements.correctAnswerDisplay.classList.remove('hidden');
                    elements.correctAnswerDisplay.innerHTML = 
                        `Correct answer: <span>${q.correctAnswer}</span>`;
                }
                
                // Generate steps
                const steps = generateSteps(q.value, q.fromBase, q.toBase, q.correctAnswer);
                elements.stepsContent.innerHTML = steps.map(s => 
                    `<div class="step-line">${s}</div>`
                ).join('');
                
                elements.continueBtn.focus();
            }

            /**
             * Continues to next question or summary
             */
            function continueToNext() {
                state.drill.currentQuestion++;
                
                if (state.drill.currentQuestion >= state.drill.questionCount) {
                    showSummary();
                } else {
                    showCurrentQuestion();
                }
            }

            /**
             * Shows the drill summary
             */
            function showSummary() {
                state.drill.active = false;
                
                const totalTime = (Date.now() - state.drill.startTime) / 1000;
                const correctCount = state.drill.questions.filter(q => q.correct).length;
                const accuracy = Math.round((correctCount / state.drill.questionCount) * 100);
                const avgTime = totalTime / state.drill.questionCount;
                
                // Update stats
                state.stats.totalDrills++;
                state.stats.totalQuestions += state.drill.questionCount;
                state.stats.correctAnswers += correctCount;
                saveState();
                
                // Display summary
                elements.summaryAccuracy.textContent = `${accuracy}%`;
                elements.summaryTotal.textContent = `${totalTime.toFixed(1)}s`;
                elements.summaryAvg.textContent = `${avgTime.toFixed(1)}s`;
                
                // Build question list
                let listHTML = '';
                state.drill.questions.forEach((q, i) => {
                    const stepsId = `steps-${i}`;
                    const steps = generateSteps(q.value, q.fromBase, q.toBase, q.correctAnswer);
                    
                    listHTML += `
                        <div class="question-item ${q.correct ? 'correct' : 'incorrect'}">
                            <div class="question-item-header">
                                <span class="question-item-q">${q.value} â†’ ${q.correctAnswer}</span>
                                <span style="color: ${q.correct ? 'var(--success)' : 'var(--error)'}">
                                    ${q.correct ? 'âœ“' : 'âœ—'}
                                </span>
                            </div>
                            <div class="question-item-answers">
                                Your answer: ${q.userAnswer} | Time: ${q.time.toFixed(1)}s
                            </div>
                            <button class="btn mt-1" style="padding: 0.5rem; font-size: 0.75rem;" 
                                    onclick="document.getElementById('${stepsId}').classList.toggle('hidden')">
                                Show Steps
                            </button>
                            <div id="${stepsId}" class="steps-content hidden mt-1">
                                ${steps.map(s => `<div class="step-line">${s}</div>`).join('')}
                            </div>
                        </div>
                    `;
                });
                
                elements.questionList.innerHTML = listHTML;
                
                showView('drillSummary');
            }

            // ============================================
            // VIEW MANAGEMENT
            // ============================================
            
            /**
             * Shows a specific view
             */
            function showView(view) {
                // Hide all views
                elements.converterView.classList.remove('active');
                elements.drillSetupView.classList.remove('active');
                elements.drillQuestionView.classList.remove('active');
                elements.drillSummaryView.classList.remove('active');
                
                // Show requested view
                switch (view) {
                    case 'converter':
                        elements.converterView.classList.add('active');
                        break;
                    case 'drillSetup':
                        elements.drillSetupView.classList.add('active');
                        break;
                    case 'drillQuestion':
                        elements.drillQuestionView.classList.add('active');
                        break;
                    case 'drillSummary':
                        elements.drillSummaryView.classList.add('active');
                        break;
                }
            }

            /**
             * Switches between main modes
             */
            function switchMode(mode) {
                state.mode = mode;
                
                // Update tabs
                elements.modeTabs.forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.mode === mode);
                });
                
                // Show appropriate view
                if (mode === 'converter') {
                    showView('converter');
                } else {
                    showView('drillSetup');
                }
            }

            // ============================================
            // THEME MANAGEMENT
            // ============================================
            
            /**
             * Toggles dark/light theme
             */
            function toggleTheme() {
                state.darkMode = !state.darkMode;
                applyTheme();
                saveState();
            }

            /**
             * Applies current theme
             */
            function applyTheme() {
                if (state.darkMode) {
                    document.documentElement.removeAttribute('data-theme');
                    elements.themeToggle.textContent = 'ðŸŒ™';
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                    elements.themeToggle.textContent = 'â˜€ï¸';
                }
            }

            // ============================================
            // PERSISTENCE
            // ============================================
            
            /**
             * Saves state to localStorage
             */
            function saveState() {
                const data = {
                    darkMode: state.darkMode,
                    stats: state.stats,
                    drillSettings: {
                        conversionType: state.drill.conversionType,
                        rangeMin: state.drill.rangeMin,
                        rangeMax: state.drill.rangeMax,
                        questionCount: state.drill.questionCount,
                        timeLimit: state.drill.timeLimit
                    }
                };
                
                try {
                    localStorage.setItem('cabsLearner', JSON.stringify(data));
                } catch (e) {
                    // localStorage not available
                }
            }

            /**
             * Loads state from localStorage
             */
            function loadState() {
                try {
                    const data = JSON.parse(localStorage.getItem('cabsLearner'));
                    if (data) {
                        if (typeof data.darkMode === 'boolean') {
                            state.darkMode = data.darkMode;
                        }
                        if (data.stats) {
                            state.stats = { ...state.stats, ...data.stats };
                        }
                        if (data.drillSettings) {
                            elements.conversionType.value = data.drillSettings.conversionType || 'random';
                            elements.rangeMin.value = data.drillSettings.rangeMin || 0;
                            elements.rangeMax.value = data.drillSettings.rangeMax || 15;
                            elements.questionCount.value = data.drillSettings.questionCount || 10;
                            if (data.drillSettings.timeLimit) {
                                elements.timeLimitToggle.classList.add('active');
                                elements.timeLimitOptions.classList.remove('hidden');
                                elements.timeLimit.value = data.drillSettings.timeLimit;
                            }
                        }
                    }
                } catch (e) {
                    // localStorage not available or parse error
                }
            }

            // ============================================
            // EVENT LISTENERS
            // ============================================
            
            function initEventListeners() {
                // Mode tabs
                elements.modeTabs.forEach(tab => {
                    tab.addEventListener('click', () => switchMode(tab.dataset.mode));
                });
                
                // Input base selector
                elements.inputBaseSelector.querySelectorAll('.base-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        elements.inputBaseSelector.querySelectorAll('.base-btn').forEach(b => 
                            b.classList.remove('active'));
                        btn.classList.add('active');
                        state.inputBase = parseInt(btn.dataset.base);
                        updateInputType();
                        updateConverter();
                    });
                });
                
                // Output base selector (multi-select)
                elements.outputBaseSelector.querySelectorAll('.base-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        btn.classList.toggle('active');
                        state.outputBases = Array.from(
                            elements.outputBaseSelector.querySelectorAll('.base-btn.active')
                        ).map(b => parseInt(b.dataset.base));
                        updateConverter();
                    });
                });
                
                // Converter input
                elements.converterInput.addEventListener('input', updateConverter);
                
                // Difficulty presets
                elements.difficultyPresets.querySelectorAll('.preset-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        elements.difficultyPresets.querySelectorAll('.preset-btn').forEach(b => 
                            b.classList.remove('active'));
                        btn.classList.add('active');
                        elements.rangeMin.value = btn.dataset.min;
                        elements.rangeMax.value = btn.dataset.max;
                    });
                });
                
                // Custom range inputs
                elements.rangeMin.addEventListener('change', () => {
                    elements.difficultyPresets.querySelectorAll('.preset-btn').forEach(b => 
                        b.classList.remove('active'));
                });
                elements.rangeMax.addEventListener('change', () => {
                    elements.difficultyPresets.querySelectorAll('.preset-btn').forEach(b => 
                        b.classList.remove('active'));
                });
                
                // Time limit toggle
                elements.timeLimitToggle.addEventListener('click', () => {
                    elements.timeLimitToggle.classList.toggle('active');
                    elements.timeLimitOptions.classList.toggle('hidden');
                });
                
                // Start drill
                elements.startDrillBtn.addEventListener('click', startDrill);
                
                // Submit answer
                elements.submitAnswerBtn.addEventListener('click', () => submitAnswer());
                elements.drillAnswer.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !elements.submitAnswerBtn.classList.contains('hidden')) {
                        submitAnswer();
                    }
                });
                
                // Show steps toggle
                elements.showStepsBtn.addEventListener('click', () => {
                    elements.stepsContent.classList.toggle('hidden');
                    elements.showStepsBtn.textContent = 
                        elements.stepsContent.classList.contains('hidden') ? 'Show Steps' : 'Hide Steps';
                });
                
                // Continue button
                elements.continueBtn.addEventListener('click', continueToNext);
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !elements.feedbackSection.classList.contains('hidden')) {
                        continueToNext();
                    }
                });
                
                // New drill
                elements.newDrillBtn.addEventListener('click', () => showView('drillSetup'));
                
                // Theme toggle
                elements.themeToggle.addEventListener('click', toggleTheme);
                
                // Tutorial
                elements.tutorialBtn.addEventListener('click', () => {
                    elements.tutorialModal.classList.add('active');
                });
                elements.closeTutorial.addEventListener('click', () => {
                    elements.tutorialModal.classList.remove('active');
                });
                elements.tutorialModal.addEventListener('click', (e) => {
                    if (e.target === elements.tutorialModal) {
                        elements.tutorialModal.classList.remove('active');
                    }
                });
            }

            // ============================================
            // INITIALIZATION
            // ============================================
            
            function init() {
                loadState();
                applyTheme();
                updateInputType();
                initEventListeners();
            }
            
            // Start the app
            init();
        })();
    </script>
</body>
</html>
